<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tic-Tac-Toe</title>
  <link href="../style/style.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
  <nav>
    <div class="settings-icon-container">
      <img src="../assets/settings.png" class="settings-icon" />
    </div>
  </nav>

  <div class="game-container">
    <div class="game-title">Tic-Tac-Toe</div>
    <div class="game-grid-container">
      <button onclick="window.location.href='game-computer.html'">Play with Computer</button>
      <button onclick="window.location.href='game-offline.html'">Play Offline</button>
      <button onclick="createPrivateRoom()">Create Private Room</button>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
        console.log("index.html: Script is running.");
        const socket = io(); // Initialize socket connection on page load

        socket.on('connect', () => {
            console.log("index.html: Socket.IO connected with ID:", socket.id);
            // DO NOT EMIT 'createRoom' HERE.
            // This is just for connection logging or setup that needs to happen once per connection.
        });

        let roomCreationInProgress = false; // Flag to prevent multiple clicks

        // THIS FUNCTION SHOULD ONLY BE CALLED BY THE BUTTON'S onclick EVENT
        function createPrivateRoom() {
            if (roomCreationInProgress) {
                console.warn("index.html: Room creation already in progress. Ignoring multiple clicks/calls.");
                return; // Exit if a room creation is already ongoing
            }
            roomCreationInProgress = true; // Set flag to true
            console.log("index.html: 'Create Private Room' button clicked. Emitting 'createRoom' event...");
            socket.emit('createRoom'); // <-- THIS IS THE ONLY PLACE THIS SHOULD BE CALLED FOR ROOM CREATION
        }

        socket.on('roomCreated', (roomCode) => {
            console.log("index.html: 'roomCreated' event received. Room Code:", roomCode);
            roomCreationInProgress = false; // Reset flag
            // Redirect to game-multiplayer.html with the room code
            window.location.href = `game-multiplayer.html?room=${roomCode}`;
        });

        // Add robust error handling
        socket.on('roomNotFound', (message) => { // Assuming your server might send a specific 'roomNotFound' for join attempts
            console.error("index.html: Room not found response from server:", message);
            roomCreationInProgress = false; // Reset flag on error
            alert("Error: " + (message || "Room not found. Please check the code or try again."));
        });

        socket.on('roomFull', (message) => {
            console.error("index.html: Room full response from server:", message);
            roomCreationInProgress = false; // Reset flag on error
            alert("Error: " + (message || "Room is full."));
        });

        socket.on('error', (message) => { // Generic Socket.IO errors
            console.error("index.html: Socket error:", message);
            roomCreationInProgress = false; // Reset flag on error
            alert("A network error occurred: " + message);
        });

        socket.on('disconnect', (reason) => {
            console.log("index.html: Socket disconnected. Reason:", reason);
            roomCreationInProgress = false; // Ensure flag is reset if disconnected
        });

    </script>
</body>
</html>
